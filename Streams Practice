CREATE TABLE emp_consume CLONE emp;

CREATE /* [OR REPLACE] */ stream emp_stream on table emp;

INSERT INTO emp values(1,'SAI', 'DEVOPS'),
                            (2, 'ROHITH', 'PEGA DEVELOPER'),
                            (3, 'MANIKANTA', 'SALESFORCE'),
                            (4, 'YATEESH', 'JAVA DEVELOPER'),
                            (5, 'CHARAN', 'SQL DEVELOPER'),
                            (6, 'GOPAL', 'AWS DEVELOPER');
                            
                            
SELECT * FROM EMP_STREAM;

INSERT INTO EMP_CONSUME SELECT EMP_ID, EMP_NAME, EMP_ROLE FROM EMP_STREAM
WHERE METADATA$ACTION = 'INSERT' AND METADATA$ISUPDATE = 'FALSE';

SELECT * FROM EMP_CONSUME;

DELETE FROM EMP WHERE EMP_ID IN (5,6);

DELETE FROM EMP_CONSUME
WHERE EMP_ID IN (SELECT EMP_ID FROM EMP_STREAM WHERE METADATA$ACTION = 'DELETE' AND METADATA$ISUPDATE = 'FALSE');

UPDATE EMP SET EMP_ROLE = 'PYTHON DEVELOPER', EMP_NAME = 'SAI RAM'
WHERE EMP_ID = 1;

INSERT INTO EMP_CONSUME SELECT EMP_ID, EMP_NAME, EMP_ROLE FROM EMP_STREAM
WHERE METADATA$ACTION = 'INSERT' AND METADATA$ISUPDATE = 'TRUE';
