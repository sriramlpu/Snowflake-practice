TRUNCATE TABLE EMP;
CREATE OR REPLACE TABLE emp_consume CLONE emp;

CREATE OR REPLACE stream emp_stream on table emp;

INSERT INTO emp values(1,'SAI', 'DEVOPS'),
                            (2, 'ROHITH', 'PEGA DEVELOPER'),
                            (3, 'MANIKANTA', 'SALESFORCE'),
                            (4, 'YATEESH', 'JAVA DEVELOPER'),
                            (5, 'CHARAN', 'SQL DEVELOPER'),
                            (6, 'GOPAL', 'AWS DEVELOPER');
                            
                            
SELECT * FROM EMP_STREAM;
SELECT * FROM EMP_CONSUME;

MERGE INTO EMP_CONSUME EC
USING EMP_STREAM ES ON EC.EMP_ID = ES.EMP_ID
WHEN MATCHED AND METADATA$ACTION = 'DELETE' AND METADATA$ISUPDATE = 'FALSE'
THEN DELETE
WHEN MATCHED AND METADATA$ACTION = 'INSERT' AND METADATA$ISUPDATE = 'TRUE'
THEN UPDATE SET EC.EMP_NAME = ES.EMP_NAME,
                EC.EMP_ROLE = ES.EMP_ROLE
WHEN NOT MATCHED AND METADATA$ACTION = 'INSERT' AND METADATA$ISUPDATE = 'FALSE'
THEN INSERT (EC.EMP_ID,EC.EMP_NAME,EC.EMP_ROLE) VALUES(ES.EMP_ID,ES.EMP_NAME,ES.EMP_ROLE);

UPDATE EMP SET EMP_ROLE = 'PYTHON DEVELOPER', EMP_NAME = 'SAI RAM'
WHERE EMP_ID = 1;

DELETE FROM EMP WHERE EMP_ID IN (5,6);
